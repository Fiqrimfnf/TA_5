<!DOCTYPE html>
<html lang="en">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>FaceTo</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- style css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Responsive-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    <!-- fevicon -->
    <link rel="icon" href="{{ url_for('static', filename='img/faceto.png') }}" type="image/gif"/>
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.mCustomScrollbar.min.css') }}">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
          media="screen">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>
<!-- body -->

<body class="main-layout">
<!-- loader  -->
<!--      <div class="loader_bg">-->
<!--         <div class="loader"><img src="{{ url_for('static', filename='images/loading.gif') }}" alt="#" /></div>-->
<!--      </div>-->
<!-- end loader -->
<div class="wrapper">
    <!-- end loader -->
    <div id="content">
        <!-- header -->
        <header>
            <!-- header inner -->
            <div class="header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                            <div class="full">
                                <div class="center-desk">
                                    <div class="logo">
                                        <a href="/"><img
                                                src="{{ url_for('static', filename='img/faceto.png') }}" alt="#"
                                                width="200px"/></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                            <ul class="btn">
                                <li class="down_btn"><a href="/addprsn">Tambah Data</a></li>
                                <li><a href="/fr_page">Presensi Wajah</a></li>
                                <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- end header inner -->
        <!-- end header -->
        <!-- banner -->
        <!-- end banner -->
        <!-- about -->
        <div id="work" class="work">
            <div class="container-fluid">
                <div class="row mt-5 mb-5">
                    <div class="col-md-6">
                        <img src="{{ url_for('video_feed') }}" width="100%" class="img-thumbnail">
                    </div>
                    <div class="col-md-6" style="height:500px; overflow-y:auto;">
                        <h3>Today Scan</h3>
                        <table class="table">
                            <thead>
                            <tr>
                                <!--                                        <th>ID</th>-->
                                <th>Nama</th>
                                <th>Golongan</th>
                                <th>Status</th>
                                <th>NIM/NIP</th>
                                <th>Waktu Presensi</th>
                            </tr>
                            </thead>
                            <tbody id="scandata">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
        <!-- end about -->
        <!--  footer -->
        <footer>
            <div class="footer">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <div class="row">
                                <div class="col-md-8 col-sm-6">
                                    <div class="address">
                                        <h3>Address </h3>
                                    </div>
                                    <ul class="location_icon">
                                        <li>Jl. Mastrip, Krajan Timur, Sumbersari, Kec. Sumbersari, Kabupaten Jember,
                                            Jawa Timur 68121
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <div class="address">
                                        <h3>master data</h3>
                                        <ul class="Menu_footer">
                                            <li class="active"><a href="#">beranda</a></li>
                                            <li><a href="/addprsn">Tambah data</a></li>
                                            <li><a href="/fr_page">Presensi Wajah</a></li>
                                            <!--                                                <li><a href="#contact">Contact </a></li>-->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <div class="row">
                                <div class="col-md-5 col-sm-6">
                                    <div class="address">
                                        <h3>ikuti kami</h3>
                                    </div>
                                    <ul class="social_icon">
                                        <li><a href="#">Facebook <i class="fa fa-facebook"
                                                                    aria-hidden="true"></i></a>
                                        </li>
                                        <li><a href="#"> Twitter<i class="fa fa-twitter" aria-hidden="true"></i></a>
                                        </li>
                                        <li><a href="#"> Linkedin<i class="fa fa-linkedin-square"
                                                                    aria-hidden="true"></i></a></li>
                                        <li><a href="#"> Youtube<i class="fa fa-youtube-play"
                                                                   aria-hidden="true"></i></a></li>
                                        <li><a href="#"> Instagram<i class="fa fa-instagram"
                                                                     aria-hidden="true"></i></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-7 col-sm-6">
                                    <div class="address">
                                        <h3>Jika membutuhkan sesuatu </h3>
                                    </div>
                                    <form class="bottom_form">
                                        <input class="enter" placeholder="Enter Your Email" type="text"
                                               name="masukkan email">
                                        <button class="sub_btn">kirim email</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="copyright">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <p>Copyright 2022 Faceto</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end footer -->
    </div>
    <div class="overlay"></div>
    <!-- Javascript files-->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-3.0.0.min.js') }}"></script>
    <!-- sidebar -->
    <script src="{{ url_for('static', filename='js/jquery.mCustomScrollbar.concat.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            let lastcnt = 0;
            let cnt;
            chkNewScan();
    
            function chkNewScan() {
                countTodayScan();
                setTimeout(chkNewScan, 1000);
            }
    
            function countTodayScan() {
                $.ajax({
                    url: '/countTodayScan',
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        cnt = data.rowcount;
                        if (cnt > lastcnt) {
                            reloadTable();
                        }
    
                        lastcnt = cnt;
                    },
                    error: function(result){
                        console.log('no result!')
                    }
                })
            }
    
            function reloadTable() {
                $.ajax({
                    url: '/loadData',
                    type: 'GET',
                    dataType: 'json',
                    success: function(response){
                        var tr = $("#scandata");
                        tr.empty();
    
                        $.each(response, function(index, item) {
                            if (item.length > 0) {
                                for (let i = 0; i < item.length; i++) {
                                    tr.append('<tr>'+
 
                                                    '<td>'+item[i][2]+'</td>'+
                                                    '<td>'+item[i][3]+'</td>'+
                                                    '<td>'+item[i][4]+'</td>'+
                                                    '<td>'+item[i][5]+'</td>'+
                                                    '<td>'+item[i][6]+'</td>'+
                                               '</tr>');
                                }
                            }
                        });
                    },
                    error: function(result){
                        console.log('no result!')
                    }
                });
            }
        });

    </script>
</div>
</body>

</html>